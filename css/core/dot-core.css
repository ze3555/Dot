:root{
  --dot-size:64px;
  --dot-radius:999px;
  --dot-bg:var(--surface-2,#151515);
  --dot-fg:var(--text,#fff);
  --dot-shadow:0 8px 24px rgba(0,0,0,.25);
  --dot-glow:0 0 12px color-mix(in oklab,var(--dot-fg),transparent 60%);
  --transition-fast:150ms ease;
  --transition-med:260ms cubic-bezier(.2,.8,.2,1);

  /* Вертикальное меню у края */
  --menu-vert-count:4;
  --menu-vert-btn-h:40px;
  --menu-vert-gap:6px;
  --menu-vert-pad:8px;
  --menu-vert-w: clamp(96px, calc(var(--dot-size) * 1.7), 240px);
  --menu-vert-h: calc(
    var(--menu-vert-pad)*2 +
    var(--menu-vert-btn-h)*var(--menu-vert-count) +
    var(--menu-vert-gap)*(var(--menu-vert-count) - 1)
  );
}

/* host */
#dot-core{
  position:fixed; left:50%; top:50%; transform:translate(-50%,-50%);
  z-index:10;

  display:grid; place-items:center;
  width:var(--dot-size); height:var(--dot-size);
  background:var(--dot-bg); color:var(--dot-fg);
  border-radius:var(--dot-radius);
  box-shadow:var(--dot-shadow), var(--dot-glow);
  border: 1px solid color-mix(in oklab, var(--dot-fg), transparent 86%);
  box-sizing: border-box;

  transition:
    width var(--transition-med),
    height var(--transition-med),
    border-radius var(--transition-med),
    transform var(--transition-med),
    background var(--transition-fast),
    color var(--transition-fast),
    box-shadow var(--transition-fast),
    left var(--transition-med),
    top var(--transition-med),
    opacity var(--transition-fast);

  overflow:hidden; cursor:pointer; will-change:width,height,border-radius,transform,left,top,box-shadow;
  touch-action:none; -webkit-user-select:none; user-select:none; -webkit-touch-callout:none;
}
#dot-core *{ -webkit-user-select:none; user-select:none; -webkit-touch-callout:none }
.no-select, .no-select *{ -webkit-user-select:none!important; user-select:none!important; -webkit-touch-callout:none!important }

#dot-core:hover{
  box-shadow:var(--dot-shadow),
    0 0 16px color-mix(in oklab,var(--dot-fg),transparent 40%),
    0 0 32px color-mix(in oklab,var(--dot-fg),transparent 60%);
}

/* micro anims */
#dot-core.dot-morph{ animation:dotMorph 220ms cubic-bezier(.2,.8,.2,1) }
@keyframes dotMorph{ from{ transform:translate(-50%,-50%) scale(.98) } to{ transform:translate(-50%,-50%) scale(1) } }
#dot-core.dot-pulse{ animation:dotPulse 240ms ease-out }
@keyframes dotPulse{
  0%{ box-shadow:var(--dot-shadow),var(--dot-glow) }
  60%{ box-shadow:var(--dot-shadow), 0 0 20px color-mix(in oklab,var(--dot-fg),transparent 30%), 0 0 40px color-mix(in oklab,var(--dot-fg),transparent 50%) }
  100%{ box-shadow:var(--dot-shadow),var(--dot-glow) }
}

/* states */
#dot-core.dot-idle{ width:var(--dot-size); height:var(--dot-size); border-radius:999px }

/* горизонтальный (центр) */
#dot-core.dot-menu:not(.dot-vert),
#dot-core.dot-theme:not(.dot-vert){
  width:min(92vw,560px);
  height:72px;
  border-radius:18px;
  padding:8px;
  cursor:default;
  /* якорь только для горизонта, чтобы «раскрывалось» от нужного края */
  transform-origin: center center;
}

/* вертикальный (док у края) */
#dot-core.dot-menu.dot-vert,
#dot-core.dot-theme.dot-vert{
  width: min(var(--menu-vert-w), calc(100vw - 16px));
  height: min(var(--menu-vert-h), calc(100vh - 16px - env(safe-area-inset-bottom)));
  border-radius:16px;
  padding: var(--menu-vert-pad);
  cursor:default;
}

/* contacts/settings как были */
#dot-core.dot-contacts{ width:min(94vw,640px); height:56px; border-radius:999px; padding:6px 10px }
#dot-core.dot-settings{ width:min(92vw,560px); height:min(50vh,520px); border-radius:16px; padding:12px }

/* content host */
.dot-content{ width:100%; height:100%; display:grid; align-items:center }
.dot-swap-in{ animation:dotSwapIn .22s cubic-bezier(.2,.8,.2,1) both }
@keyframes dotSwapIn{ from{ opacity:0; transform:translateY(6px) } to{ opacity:1; transform:none } }

/* drag/dock */
#dot-core.dot-free{ transform:translate(0,0) }
#dot-core.dot-docked{ transform:translate(0,0) scale(.94); opacity:.92 }
#dot-core.dot-docked:hover{ opacity:1 }
#dot-core.dot-docked.dot-expanding{ transform:translate(0,0) scale(1); opacity:1 }
/* Жёсткий экранный кламп для дота и любых раскрытых состояний */
#dot-core {
  max-width: calc(100vw - 16px);
  max-height: calc(100vh - 16px);
  inset: auto; /* сброс лишних абсолютных inset, если есть */
}

#dot-core.dot-menu,
#dot-core.dot-theme,
#dot-core.dot-contacts,
#dot-core.dot-settings {
  max-width: calc(100vw - 16px);
  max-height: calc(100vh - 16px);
}
/* Не анимируем top при раскрытии/закрытии — чтобы точка не «ехала» */
#dot-core.dot-menu,
#dot-core.dot-theme,
#dot-core.dot-contacts,
#dot-core.dot-settings {
  transition:
    width var(--transition-med),
    height var(--transition-med),
    border-radius var(--transition-med),
    transform var(--transition-med),
    background var(--transition-fast),
    color var(--transition-fast),
    box-shadow var(--transition-fast),
    left var(--transition-med);
  /* top намеренно исключён из transition */
}

/* На всякий: в вертикальном режиме у края точно без анимации top */
#dot-core.dot-vert {
  transition:
    width var(--transition-med),
    height var(--transition-med),
    border-radius var(--transition-med),
    transform var(--transition-med),
    background var(--transition-fast),
    color var(--transition-fast),
    box-shadow var(--transition-fast),
    left var(--transition-med);
}