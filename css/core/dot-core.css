:root{
  --dot-size:64px;
  --dot-radius:999px;
  --dot-bg:var(--surface-2,#151515);
  --dot-fg:var(--text,#fff);
  --dot-shadow:0 8px 24px rgba(0,0,0,.25);
  --dot-glow:0 0 12px color-mix(in oklab,var(--dot-fg),transparent 60%);
  --transition-fast:150ms ease;
  --transition-med:260ms cubic-bezier(.2,.8,.2,1);

  /* Вертикальное меню у края */
  --menu-vert-count:4;
  --menu-vert-btn-h:40px;

  /* безоп. отступы, на случай iOS */
  --safe-l: env(safe-area-inset-left, 0px);
  --safe-r: env(safe-area-inset-right, 0px);
  --safe-t: env(safe-area-inset-top, 0px);
  --safe-b: env(safe-area-inset-bottom, 0px);
}

/* host */
#dot-core{
  position:fixed; left:50%; top:50%; transform:translate(-50%,-50%);
  z-index:10;

  display:grid; place-items:center;
  width:var(--dot-size); height:var(--dot-size);
  background:var(--dot-bg); color:var(--dot-fg);
  border-radius:var(--dot-radius);
  box-shadow:var(--dot-shadow), var(--dot-glow);
  border: 1px solid color-mix(in oklab, var(--dot-fg), transparent 86%);
  box-sizing: border-box;

  transition:
    width var(--transition-med),
    height var(--transition-med),
    border-radius var(--transition-med),
    transform var(--transition-med),
    background var(--transition-fast),
    color var(--transition-fast),
    box-shadow var(--transition-fast),
    left var(--transition-med),
    top var(--transition-med),
    opacity var(--transition-fast);

  overflow:hidden; cursor:pointer; will-change:width,height,border-radius,transform,left,top,box-shadow;
}

.no-select, .no-select *{ -webkit-user-select:none; user-select:none; -webkit-touch-callout:none }
.no-select, .no-select *{ -webkit-user-select:none!important; user-select:none!important; -webkit-touch-callout:none!important }

#dot-core:hover{
  box-shadow:var(--dot-shadow),
    0 0 16px color-mix(in oklab,var(--dot-fg),transparent 40%),
    0 0 32px color-mix(in oklab,var(--dot-fg),transparent 60%);
}

/* micro anims — БЕЗ изменения transform */
#dot-core.dot-morph{ animation:dotMorphShadow 220ms cubic-bezier(.2,.8,.2,1) }
/* раньше тут был dotMorph с translate(-50%,-50%), он и давал «прыжок» */
@keyframes dotMorphShadow{
  from{
    box-shadow:var(--dot-shadow), 0 0 8px color-mix(in oklab,var(--dot-fg),transparent 70%);
    opacity:.98
  }
  to{
    box-shadow:var(--dot-shadow), var(--dot-glow);
    opacity:1
  }
}

#dot-core.dot-pulse{ animation:dotPulse 240ms ease-out }
@keyframes dotPulse{
  0%{ box-shadow:var(--dot-shadow),var(--dot-glow) }
  60%{ box-shadow:var(--dot-shadow), 0 0 20px color-mix(in oklab,var(--dot-fg),transparent 50%), 0 0 40px color-mix(in oklab,var(--dot-fg),transparent 50%) }
  100%{ box-shadow:var(--dot-shadow),var(--dot-glow) }
}

/* states */
#dot-core.dot-idle{ width:var(--dot-size); height:var(--dot-size); border-radius:999px }

/* горизонтальный (центр) */
#dot-core.dot-menu:not(.dot-vert),
#dot-core.dot-theme:not(.dot-vert){
  width:min(92vw,560px);
  height:72px;
  border-radius:18px;
  padding:8px;
  cursor:default;
  /* якорь только для горизонта, чтобы «раскрывалось» от нужного края */
  transform-origin: center center;
}

/* вертикальный (док у края) */
#dot-core.dot-menu.dot-vert,
#dot-core.dot-theme.dot-vert{
  width:64px;
  height: calc(
    var(--menu-vert-count) * var(--menu-vert-btn-h) +
    var(--menu-vert-btn-h)/3 +
    var(--menu-vert-count) * 8px +
    var(--menu-vert-gap)*(var(--menu-vert-count) - 1)
  );
  border-radius:18px;
  padding:8px 6px;
  transform-origin: center center;
}

/* contacts/settings — прямоугольные окна */
#dot-core.dot-contacts,
#dot-core.dot-settings{
  width:min(92vw,560px);
  height: min(50vh, 520px);
  border-radius:18px;
  padding:10px;
  cursor:default;
  transform-origin:center center;
}

#dot-core.dot-settings {
  max-width: calc(100vw - 16px);
  max-height: calc(100vh - 16px);
}

/* Не анимируем top при раскрытии/закрытии — чтобы точка не «ехала» */
#dot-core.dot-menu,
#dot-core.dot-theme,
#dot-core.dot-contacts,
#dot-core.dot-settings {
  transition:
    width var(--transition-med),
    height var(--transition-med),
    border-radius var(--transition-med),
    transform var(--transition-med),
    background var(--transition-fast),
    color var(--transition-fast),
    box-shadow var(--transition-fast),
    left var(--transition-med);
  /* top намеренно исключён из transition */
}

/* На всякий: в вертикальном режиме у края точно без анимации top */
#dot-core.dot-menu.dot-vert,
#dot-core.dot-theme.dot-vert{
  transition:
    width var(--transition-med),
    height var(--transition-med),
    border-radius var(--transition-med),
    transform var(--transition-med),
    background var(--transition-fast),
    color var(--transition-fast),
    box-shadow var(--transition-fast),
    left var(--transition-med);
}

/* Когда точку двигаем или докнули — выключаем все переходы,
   чтобы не было «подпрыгиваний» при клампе/пересчётах */
#dot-core.dot-free,
#dot-core.dot-docked {
  transition: none !important;      /* вырубаем все CSS-переходы */
  animation: none !important;
}

/* На всякий — внутренности тоже без анимаций/переходов */
#dot-core * {
  transition: none !important;
  animation: none !important;
}

/* Контент контейнер */
.dot-content{
  width:100%; height:100%;
  display:grid; place-items:center;
}

/* -------- Вертикальное меню (у края) -------- */
.is-vert .menu-grid{
  display:grid;
  grid-template-rows: repeat(var(--menu-vert-count), var(--menu-vert-btn-h));
  grid-auto-flow: row;
  gap: 8px;
  align-content:start;
  justify-items:stretch;
}
.is-vert .menu-btn{
  height: var(--menu-vert-btn-h);
}

/* Focus ring для всей капсулы контактов (при focus-within) */
#dot-core.dot-contacts:focus-within {
  outline: 0;
  box-shadow:
    0 6px 22px rgba(0,0,0,.28),
    0 0 0 4px color-mix(in oklab, var(--dot-fg), transparent 70%);
}

/* No-anim fallback для капсулы контактов */
.dot-contacts-wrap {
  opacity: 1 !important;
  transform: none !important;
}
.dot-contacts-wrap.is-live {
  animation: none !important;
}